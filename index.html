<!-- index.html to test what markup would look like locally (independent of target) -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Q Quiz</title>
    <meta name="description" content="">
    <link rel="stylesheet" href="https://service.sophie.nzz.ch/bundle/sophie-q@^1,sophie-font@^1,sophie-color@^1,sophie-viz-color@^1,sophie-input@~0.1.0[range].css">
    <script src="https://rawgit.com/filamentgroup/loadCSS/master/src/loadCSS.js"></script> 
    <script src="https://cdnjs.cloudflare.com/ajax/libs/loadjs/3.5.0/loadjs.min.js"></script>
  </head>
  <body>
    <div id="container">
      <div id="quiz"></div>
    </div>
    <script src="node_modules/systemjs/dist/system-production.js"></script>
    <script>
      let data = {
        "item": {
          "title": "Literatur-Quiz",
          "elements": [
            {
              "id": "24e0125fe3583db8016ae44c2df47a64-1492786574258-7503",
              "question": "In welcher Stadt spielt James Joyces \"Ulysses\"?",
              "type": "mapPointGuess",
              "answer": {
                "lat": 53.33928,
                "lng": -6.281314
              },
              "answerText": "\"Ulysses\" von James Joyce spielt am 16. Juni 1904 in Dublin.",
              "notes": "",
              "articleRecommendations": [],
              "pointLabel": "Dublin",
              "bbox": "-13.710937500000002,42.42345651793833,28.4765625,57.51582286553883"
            }
          ]
        },
        toolRuntimeConfig: {
          toolBaseUrl: `http://${window.location.hostname}:3000`,
          saveAnswer: true
        }
      };

      function loadAllScripts(scripts, index, callback) {
        if (scripts[index] && scripts[index].url) {
          loadjs(scripts[index].url, () => {
            loadAllScripts(scripts, index + 1, callback)
          })
        } else {
          callback();
        }
      }

      fetch(`http://localhost:3000/rendering-info/html-js`, {
          method: 'POST',
          body: JSON.stringify(data),
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          return response.json();
        })
        .then(data => {
          data.stylesheets.forEach(stylesheet => {
            if (stylesheet.name) {
              stylesheet.url = `http://localhost:3000/stylesheet/${stylesheet.name}`
            }
            loadCSS(stylesheet.url)
          })
          document.getElementById('quiz').innerHTML = data.markup;

          if (!data.scripts) {
            return;
          }
          data.scripts = data.scripts
            .map(script => {
              if (script.name) {
                script.url = `http://${window.location.hostname}:3000/script/${script.name}`
              }
              return script;
            })
          let urlScripts = data.scripts
            .filter(script => script.url)
          let contentScripts = data.scripts
            .filter(script => script.content)
          loadAllScripts(urlScripts, 0, () => {
            contentScripts.forEach(script => {
              let scriptElement = document.createElement('script');
              scriptElement.innerHTML = script.content;
              document.getElementById('quiz').appendChild(scriptElement);
            })
          })
        })
    </script>
  </body>
</html>
