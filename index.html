<!-- index.html to test what markup would look like locally (independent of target) -->
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Q Quiz</title>
    <meta name="description" content="">
    <link rel="stylesheet" href="https://service.sophie.nzz.ch/bundle/sophie-q@^1,sophie-font@^1,sophie-color@^1,sophie-viz-color@^1,sophie-input@~0.1.0[range].css">
    <script src="https://rawgit.com/filamentgroup/loadCSS/master/src/loadCSS.js"></script> 
    <script>
      /*! loadJS: load a JS file asynchronously. [c]2014 @scottjehl, Filament Group, Inc. (Based on http://goo.gl/REQGQ by Paul Irish). Licensed MIT */
      (function( w ){
        var loadJS = function( src, cb ){
          "use strict";
          var ref = w.document.getElementsByTagName( "script" )[ 0 ];
          var script = w.document.createElement( "script" );
          script.src = src;
          script.async = true;
          ref.parentNode.insertBefore( script, ref );
          if (cb && typeof(cb) === "function") {
            script.onload = cb;
          }
          return script;
        };
        // commonjs
        if( typeof module !== "undefined" ){
          module.exports = loadJS;
        }
        else {
          w.loadJS = loadJS;
        }
      }( typeof global !== "undefined" ? global : this ));
    </script>
  </head>
  <body>
    <div id="container">
      <div id="quiz"></div>
    </div>Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet. Lorem ipsum dolor sit amet, consetetur sadipscing elitr, sed diam nonumy eirmod tempor invidunt ut labore et dolore magna aliquyam erat, sed diam voluptua. At vero eos et accusam et justo duo dolores et ea rebum. Stet clita kasd gubergren, no sea takimata sanctus est Lorem ipsum dolor sit amet.some other stuff </div>
    <script src="node_modules/systemjs/dist/system-production.js"></script>
    <script>
      let data = {
        "item": {
          "title": "Literatur-Quiz",
          "elements": [
            {
              "title": "Wie gut kennen Sie die Weltliteratur?",
              "type": "cover",
              "id": "24e0125fe3583db8016ae44c2df47a64-1492782826375-7417"
            },
            {
              "id": "24e0125fe3583db8016ae44c2df47a64-1492782862005-3923",
              "question": "Wie heisst der Autor der \"Odyssee\"?",
              "type": "multipleChoice",
              "choices": [
                "James Joyce",
                "Friedrich Dürrenmatt",
                "Ernst Jandl",
                "Derek Walcott"
              ],
              "answer": "Homer",
              "answerText": "Homer hatte die \"Odyssee\" gesungen, von James Joyce stammte der \"Ulysses\", und Derek Walcott hatte das Epos \"Omeros\" geschrieben.",
              "notes": "Ein paar Anmerkungen könnten hier stehen",
              "articleRecommendations": [
                {
                  "text": "Der karibische Dichter Derek Walcott hatte 1992 den Literaturnobelpreis erhalten und ist im letzten März 87-jährig gestorben:",
                  "articleId": "ld.152029"
                }
              ]
            },
            {
              "id": "24e0125fe3583db8016ae44c2df47a64-1492783275801-3327",
              "question": "Welchen Preis erzielte im Jahr 2000 die Auktion der ersten Manuskript-Seite von Marcel Prousts \"A la recherche du temps perdu\"?",
              "type": "numberGuess",
              "unit": "£",
              "min": "100000",
              "max": "1000000",
              "step": "50",
              "answer": "663750",
              "answerText": "Die Manuskript-Seite wurde im Juli 2000 bei Christie's für 663'750 Pfund versteigert.",
              "notes": "",
              "image": {
                "url": "http://www.famousauthors.org/famous-authors/marcel-proust.jpg"
              },
              "articleRecommendations": [
                {
                  "text": "Marcel Proust war übrigens auch ein grandioser Briefschreiber:",
                  "articleId": "ld.144636"
                }
              ]
            },
            {
              "id": "24e0125fe3583db8016ae44c2df47a64-1492786169038-1451",
              "question": "Welches ist das meist verkaufte und in die meisten Sprachen übersetzte Buch der Schweizer Literaturgeschichte?",
              "type": "multipleChoice",
              "choices": [
                "\"Der grüne Heinrich\" von Gottfried Keller",
                "\"Anne Bäbi Jowäger\" von Jeremias Gotthelf",
                "\"Stiller\" von Max Frisch"
              ],
              "answer": "\"Heidi\" von Johanna Spyri",
              "answerText": "Johanna Spyris 1880 erschienenes Jugendbuch \"Heidi\" wurde in mehr als fünfzig Sprachen übersetzt.",
              "notes": "",
              "articleRecommendations": []
            },
            {
              "id": "24e0125fe3583db8016ae44c2df47a64-1492786574258-7503",
              "question": "In welcher Stadt spielt James Joyces \"Ulysses\"?",
              "type": "mapPointGuess",
              "answer": {
                "type": "Feature",
                "geometry": {
                  "type": "Point",
                  "coordinates": [
                    -6.281314,
                    53.33928
                  ]
                },
                "properties": {
                  "pointLabel": "Dublin"  
                },
                "bbox": [
                  -13.710937500000002,
                  42.42345651793833,
                  28.4765625,
                  57.51582286553883
                ]
              },
              "answerText": "\"Ulysses\" von James Joyce spielt am 16. Juni 1904 in Dublin.",
              "notes": "",
              "articleRecommendations": [],
            },
            {
              "id": "24e0125fe3583db8016ae44c2df47a64-1492786574258-7504",
              "type": "lastCard",
              "title": "The last one",
              "text": "The very last.....",
              "quizLink": "https://www.nzz.ch/feuilleton/nzz-quizz-twin-peaks-kehrt-zurueck-ld.1294313",
              "quizTitle": "Was wissen Sie über Twin Peaks",
              "articleRecommendations": [
                {
                  "text": "Der karibische Dichter Derek Walcott hatte 1992 den Literaturnobelpreis erhalten und ist im letzten März 87-jährig gestorben:",
                  "articleId": "ld.152029"
                }
              ]
            }
          ]
        },
        toolRuntimeConfig: {
          toolBaseUrl: `http://localhost:3000`,
          isPure: false
        }
      };

      function loadAllScripts(scripts, index, callback) {
        if (scripts[index] && scripts[index].url) {
          loadJS(scripts[index].url, () => {
            loadAllScripts(scripts, index + 1, callback)
          })
        } else {
          callback();
        }
      }

      // setup event listeners to show tracking events
      document.getElementById('quiz')
        .addEventListener('q-quiz-next-screen', event => {
          console.log(event);
        })
      document.getElementById('quiz')
        .addEventListener('q-quiz-answer', event => {
          console.log(event);
        })

      fetch(`http://localhost:3000/rendering-info/html-js`, {
          method: 'POST',
          body: JSON.stringify(data),
          headers: {
            'Content-Type': 'application/json'
          }
        })
        .then(response => {
          return response.json();
        })
        .then(data => {
          data.stylesheets.forEach(stylesheet => {
            if (stylesheet.name) {
              stylesheet.url = `http://localhost:3000/stylesheet/${stylesheet.name}`
            }
            loadCSS(stylesheet.url)
          })
          document.getElementById('quiz').innerHTML = data.markup;

          if (!data.scripts) {
            return;
          }
          data.scripts = data.scripts
            .map(script => {
              if (script.name) {
                script.url = `http://${window.location.hostname}:3000/script/${script.name}`
              }
              return script;
            })
          let urlScripts = data.scripts
            .filter(script => script.url)
          let contentScripts = data.scripts
            .filter(script => script.content)
          loadAllScripts(urlScripts, 0, () => {
            contentScripts.forEach(script => {
              let scriptElement = document.createElement('script');
              scriptElement.innerHTML = script.content;
              document.getElementById('quiz').appendChild(scriptElement);
            })
          })
        })
    </script>
  </body>
</html>
